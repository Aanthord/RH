<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Post‑Cantorian RH — Single‑File Tester</title>
  <meta name="description" content="FTC/RSF falsifiability harness for RH — single‑file build" />
  <!-- Tailwind (Play CDN) for quick styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Recharts UMD -->
  <script crossorigin src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
  <!-- Babel for on‑the‑fly JSX (single‑file savage mode) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* Just in case Tailwind fails to load, keep some sane defaults */
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    .card { border: 1px solid rgba(0,0,0,.08); border-radius: 16px; background: #fff; }
    .mono { font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace; }
  </style>
</head>
<body class="min-h-screen bg-neutral-100">
  <main class="max-w-7xl mx-auto p-6">
    <h1 class="text-3xl font-bold text-center mb-2">Post‑Cantorian RH Proof Tester</h1>
    <p class="text-center text-neutral-600 mb-6">FTC Recursive Integration · RSF Generation Symmetry · Single‑file</p>

    <div id="app"></div>

    <footer class="mt-10 text-center text-xs text-neutral-500">
      Built savage‑style: one <code class="mono">index.html</code>. Powered by React + Recharts + Tailwind CDNs.
    </footer>
  </main>

  <script type="text/babel">
    const { useState } = React;
    const {
      LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend,
      ResponsiveContainer, ReferenceLine
    } = Recharts;

    function RHProofTester() {
      const [energyData, setEnergyData] = useState([]);
      const [convexityData, setConvexityData] = useState([]);
      const [densityData, setDensityData] = useState([]);
      const [isComputing, setIsComputing] = useState(false);
      const [results, setResults] = useState("");
      const [maxDepth, setMaxDepth] = useState(20);
      const [tMax, setTMax] = useState(30);
      const [tau, setTau] = useState(0.001);

      // Config space growth
      const computeConfigurationSpace = (depth) => depth * depth + depth;

      // Recursive realizations (toy model)
      const computeRecursiveRealizations = (_structure, sigma, t, depth) => {
        const u = sigma - 0.5;
        const base = Math.exp(-Math.abs(u) * depth);
        const osc = Math.cos(t / Math.sqrt(depth + 1));
        const mod = 1 / (1 + depth / 10);
        const mult = Math.abs(u) > 0.01 ? 4 : 1; // quartet off‑line
        return Math.max(0.001, Math.abs(base * osc * mod) * mult);
      };

      // Fractal density D_k ≈ weighted limit of F_i/G_i
      const computeFractalDensity = (structure, sigma, t, maxDepthLocal = maxDepth) => {
        let num = 0, den = 0;
        for (let i = 1; i <= maxDepthLocal; i++) {
          const Fi = computeRecursiveRealizations(structure, sigma, t, i);
          const Gi = computeConfigurationSpace(i);
          const Di = Fi / Gi;
          const w = 1 / i;
          num += Di * w; den += w;
        }
        return num / den;
      };

      // FTC recursive derivative in σ via layer differences
      const computeRecursiveDerivative = (sigma, t, h = 1e-3) => {
        let num = 0, den = 0;
        for (let n = 1; n <= maxDepth; n++) {
          const Fn = computeRecursiveRealizations('zeta', sigma, t, n);
          const FnPlus = computeRecursiveRealizations('zeta', sigma + h, t, n);
          const Gn = computeConfigurationSpace(n);
          const GnPlus = computeConfigurationSpace(n + 1);
          const diff = (FnPlus - Fn) / (GnPlus - Gn + 1e-3);
          const w = 1 / n;
          num += diff * w; den += w;
        }
        return num / den;
      };

      // FTC‑admissible measure dμ(t)
      const measure = (t) => Math.exp(-(t * t) / 100) * (1 + 0.1 * Math.sin(t / 5));

      // Energy E(σ) = ∫ (∂σ L)^2 dμ × density factor
      const energy = (sigma, tMaxLocal = tMax, pts = 200) => {
        let acc = 0;
        const dt = (2 * tMaxLocal) / pts;
        for (let i = 0; i < pts; i++) {
          const t = -tMaxLocal + i * dt;
          const d = computeRecursiveDerivative(sigma, t);
          acc += d * d * measure(t) * computeFractalDensity('integration', sigma, t) * dt;
        }
        return acc;
      };

      // Smoothed second derivative via τ‑step
      const energySecond = (sigma, tauLocal = tau) => {
        const h = tauLocal;
        const Ep = energy(sigma + h);
        const E0 = energy(sigma);
        const Em = energy(sigma - h);
        const raw = (Ep - 2 * E0 + Em) / (h * h);
        return raw * Math.exp(-tauLocal * Math.abs(raw));
      };

      const run = () => {
        setIsComputing(true);
        setResults('Computing with FTC framework...\n');
        setTimeout(() => {
          const lines = [];
          lines.push('POST‑CANTORIAN RH PROOF FALSIFIABILITY TESTS');
          lines.push('=======================================================\n');
          lines.push(`Max Recursive Depth: ${maxDepth}`);
          lines.push(`tMax: ${tMax}, τ: ${tau}\n`);

          const sigmas = [0.1, 0.25, 0.4, 0.5, 0.6, 0.75, 0.9];

          // Energy sweep
          const e = [];
          sigmas.forEach(s => { const v = energy(s, 20, 100); e.push({ sigma: s, energy: v }); lines.push(`E(${s}) = ${v.toFixed(6)}`); });
          setEnergyData(e);

          // Convexity
          lines.push('\nConvexity (E\'\'):');
          const c = [];
          sigmas.forEach(s => { const v = energySecond(s); c.push({ sigma: s, secondDerivative: v }); lines.push(`E''(${s}) = ${v.toFixed(6)} ${v >= -0.1 ? '✓' : '✗'}`); });
          setConvexityData(c);

          // Density
          lines.push('\nFractal Density D_k(σ):');
          const d = [];
          sigmas.forEach(s => { const v = computeFractalDensity('energy', s, 0); d.push({ sigma: s, density: v }); lines.push(`D_k(${s}) = ${v.toFixed(6)}`); });
          setDensityData(d);

          setResults(lines.join('\n'));
          setIsComputing(false);
        }, 60);
      };

      const copyResults = async () => {
        try { await navigator.clipboard.writeText(results || ''); } catch {}
      };

      const downloadCSV = () => {
        const rows = ['type,sigma,value']
          .concat(energyData.map(r => `energy,${r.sigma},${r.energy}`))
          .concat(convexityData.map(r => `secondDerivative,${r.sigma},${r.secondDerivative}`))
          .concat(densityData.map(r => `density,${r.sigma},${r.density}`));
        const blob = new Blob([rows.join('\n')], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'ftc_rh_results.csv';
        a.click();
        URL.revokeObjectURL(a.href);
      };

      return (
        <div>
          <div className="mb-6 flex flex-wrap items-center gap-3 justify-center">
            <button onClick={run} disabled={isComputing} className="px-6 py-3 rounded-2xl shadow bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50">
              {isComputing ? 'Computing FTC…' : 'Run Tests'}
            </button>
            <label className="text-sm">Max Depth: <input type="number" min="5" max="50" value={maxDepth} onChange={e=>setMaxDepth(parseInt(e.target.value||'0',10))} className="w-20 px-2 py-1 border rounded ml-1"/></label>
            <label className="text-sm">tMax: <input type="number" min="10" max="60" value={tMax} onChange={e=>setTMax(parseInt(e.target.value||'0',10))} className="w-20 px-2 py-1 border rounded ml-1"/></label>
            <label className="text-sm">τ: <input type="number" step="0.001" min="0.000" max="0.100" value={tau} onChange={e=>setTau(parseFloat(e.target.value||'0'))} className="w-24 px-2 py-1 border rounded ml-1"/></label>
            <button onClick={copyResults} className="px-3 py-2 rounded-lg border bg-white hover:bg-neutral-50">Copy Results</button>
            <button onClick={downloadCSV} className="px-3 py-2 rounded-lg border bg-white hover:bg-neutral-50">Download CSV</button>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <ChartCard title="FTC Energy Functional E(σ)">
              <ResponsiveContainer width="100%" height={240}>
                <LineChart data={energyData} margin={{ top: 10, right: 20, left: 0, bottom: 0 }}>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="sigma" />
                  <YAxis />
                  <Tooltip />
                  <Legend />
                  <ReferenceLine x={0.5} stroke="#111827" strokeDasharray="4 4" label="σ = 1/2" />
                  <Line type="monotone" dataKey="energy" stroke="#6366f1" strokeWidth={2} dot={false} />
                </LineChart>
              </ResponsiveContainer>
            </ChartCard>

            <ChartCard title="Convexity E''(σ)">
              <ResponsiveContainer width="100%" height={240}>
                <LineChart data={convexityData} margin={{ top: 10, right: 20, left: 0, bottom: 0 }}>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="sigma" />
                  <YAxis />
                  <Tooltip />
                  <Legend />
                  <ReferenceLine x={0.5} stroke="#111827" strokeDasharray="4 4" label="σ = 1/2" />
                  <Line type="monotone" dataKey="secondDerivative" stroke="#10b981" strokeWidth={2} dot={false} />
                </LineChart>
              </ResponsiveContainer>
            </ChartCard>

            <ChartCard title="Fractal Density Dₖ(σ)">
              <ResponsiveContainer width="100%" height={240}>
                <LineChart data={densityData} margin={{ top: 10, right: 20, left: 0, bottom: 0 }}>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="sigma" />
                  <YAxis />
                  <Tooltip />
                  <Legend />
                  <ReferenceLine x={0.5} stroke="#111827" strokeDasharray="4 4" label="σ = 1/2" />
                  <Line type="monotone" dataKey="density" stroke="#f59e0b" strokeWidth={2} dot={false} />
                </LineChart>
              </ResponsiveContainer>
            </ChartCard>
          </div>

          <div className="card p-4">
            <h3 className="text-lg font-semibold mb-2">Test Results</h3>
            <pre className="mono whitespace-pre-wrap text-sm bg-white p-4 rounded border overflow-auto max-h-96">{results || 'Click “Run Tests” to begin FTC analysis…'}</pre>
          </div>
        </div>
      );
    }

    function ChartCard({ title, children }) {
      return (
        <div className="card p-4">
          <h3 className="text-lg font-semibold mb-3">{title}</h3>
          {children}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('app'));
    root.render(<RHProofTester />);
  </script>
</body>
</html>
